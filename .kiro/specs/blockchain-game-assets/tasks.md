# 구현 계획

이 문서는 블록체인 게임 자산 시스템과 NFT 마켓플레이스의 구현 작업 목록입니다. 각 작업은 요구사항 문서의 승인 기준을 충족하도록 구현되어야 합니다.

## 작업 목록

- [x] 1. 스마트 컨트랙트 개발 및 배포




  - ERC-20 토큰 컨트랙트와 ERC-721 NFT 컨트랙트를 작성하고 Sepolia 테스트넷에 배포
  - _요구사항: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6_

- [x] 1.1 ERC-20 게임 토큰 컨트랙트 작성



  - OpenZeppelin ERC20 라이브러리를 사용하여 GameToken.sol 작성
  - mint() 및 burn() 함수 구현
  - 초기 공급량 설정 (1,000,000 토큰)
  - _요구사항: 8.1_



- [x] 1.2 ERC-721 NFT 컨트랙트 작성

  - OpenZeppelin ERC721URIStorage 라이브러리 사용하여 GameAssetNFT.sol 작성
  - mint(), burn(), tokenURI() 함수 구현
  - Transfer 이벤트 발생 로직 추가

  - _요구사항: 8.1, 8.2, 8.5, 8.6_

- [x] 1.3 Hardhat 프로젝트 설정 및 컨트랙트 배포



  - Hardhat 프로젝트 초기화
  - Sepolia 테스트넷 설정 추가
  - 배포 스크립트 작성 (deploy.js)
  - 컨트랙트 배포 및 주소 기록
  - _요구사항: 8.1_

- [ ]* 1.4 스마트 컨트랙트 단위 테스트 작성
  - Hardhat/Chai를 사용한 테스트 작성
  - mint, burn, transfer 기능 테스트
  - 권한 검증 테스트
  - _요구사항: 8.1, 8.4_

- [x] 2. 데이터베이스 스키마 구축



  - MariaDB에 필요한 테이블을 생성하고 인덱스 설정
  - _요구사항: 9.1, 9.2, 9.3, 9.6_




- [ ] 2.1 기본 NFT 관리 테이블 생성
  - nft_records, transaction_log, auth_sessions 테이블 생성

  - 인덱스 및 외래키 설정
  - _요구사항: 9.1_

- [ ] 2.2 마켓플레이스 테이블 생성
  - marketplace_listings, server_shop, purchase_history 테이블 생성

  - auth_nonces 테이블 생성 (재생 공격 방지)
  - 인덱스 설정
  - _요구사항: 12.4, 13.1, 13.10_

- [ ] 2.3 초기 서버 상점 데이터 삽입
  - 몬스터 소환권 샘플 데이터 삽입
  - 가격, 재고, 메타데이터 설정
  - _요구사항: 13.1_

- [x] 3. Node.js 브릿지 서버 기본 구조 구축



  - Express.js 서버 설정 및 미들웨어 구성
  - _요구사항: 1.3, 5.1, 7.5_

- [x] 3.1 Express.js 프로젝트 초기화


  - package.json 설정 및 의존성 설치
  - TypeScript 설정 (선택사항)
  - 환경 변수 관리 (.env 파일)
  - _요구사항: 7.2_


- [ ] 3.2 기본 미들웨어 설정
  - CORS 설정
  - JSON body parser
  - 에러 핸들러 미들웨어
  - 로깅 미들웨어 (Morgan 또는 Winston)
  - _요구사항: 6.4_


- [ ] 3.3 데이터베이스 연결 설정
  - MariaDB 연결 풀 생성
  - 데이터베이스 헬퍼 함수 작성 (query, insert, update, delete)
  - _요구사항: 9.1_

- [x] 4. IPFS 통합 구현



  - Pinata API를 사용하여 메타데이터와 이미지를 IPFS에 업로드
  - _요구사항: 2.2, 4.3, 4.6_


- [x] 4.1 IPFS Manager 클래스 작성

  - Pinata API 클라이언트 설정
  - uploadMetadata() 함수 구현
  - uploadImage() 함수 구현
  - 재시도 로직 포함 (최대 3회)
  - _요구사항: 2.2, 6.2_


- [ ] 4.2 메타데이터 생성 헬퍼 함수
  - ERC-721 표준 준수 JSON 생성
  - IPFS CID를 image 필드에 포함
  - _요구사항: 4.1, 4.2, 4.3_

- [x] 5. 블록체인 서비스 구현


  - Web3.js를 사용하여 스마트 컨트랙트와 상호작용
  - _요구사항: 2.3, 3.4, 5.2, 5.4_

- [x] 5.1 BlockchainService 클래스 작성



  - Web3 인스턴스 초기화
  - 컨트랙트 ABI 로드
  - 관리자 계정 설정
  - _요구사항: 7.2_

- [x] 5.2 NFT 민팅 함수 구현

  - mintNFT() 함수 작성
  - 가스 추정 및 트랜잭션 서명
  - 트랜잭션 전송 및 영수증 반환
  - _요구사항: 2.3, 2.4_

- [x] 5.3 NFT 소각 함수 구현

  - burnNFT() 함수 작성
  - 소유권 검증 로직
  - _요구사항: 3.4, 3.5_

- [x] 5.4 토큰 전송 및 조회 함수 구현

  - transferTokens() 함수 (ERC-20 토큰 전송)
  - getTokenBalance() 함수 (토큰 잔액 조회)
  - transferNFT() 함수 (NFT 소유권 이전)
  - verifyOwnership() 함수 (NFT 소유권 확인)
  - _요구사항: 12.7, 12.8, 13.4_

- [x] 5.5 트랜잭션 상태 추적 구현

  - getTransactionStatus() 함수 작성
  - 5초 간격 폴링 로직
  - 타임아웃 처리 (5분)
  - _요구사항: 5.2, 5.3, 5.5_

- [ ] 6. 게임 클라이언트 API 엔드포인트 구현
  - UE5 클라이언트를 위한 NFT 민팅/소각 API
  - _요구사항: 2.1, 3.1, 5.1_

- [ ] 6.1 인증 API 구현
  - POST /api/auth/verify-signature 엔드포인트
  - EIP-4361 서명 검증 로직
  - JWT 토큰 발급
  - _요구사항: 1.1, 1.2, 1.3, 1.4_

- [ ] 6.2 NFT 민팅 API 구현
  - POST /api/nft/mint 엔드포인트
  - 요청 검증 및 큐 추가
  - IPFS 업로드 → 블록체인 민팅 → DB 저장 플로우
  - 응답 반환 (tokenId, txHash, status)
  - _요구사항: 2.1, 2.2, 2.3, 2.5, 2.6, 2.7_

- [ ] 6.3 NFT 소각 API 구현
  - POST /api/nft/burn 엔드포인트
  - 소유권 검증
  - 블록체인 소각 → DB 업데이트 플로우
  - _요구사항: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

- [ ] 6.4 트랜잭션 조회 API 구현
  - GET /api/transaction/:txHash 엔드포인트
  - 블록체인에서 트랜잭션 상태 조회
  - _요구사항: 5.1, 5.4_

- [ ] 6.5 플레이어 NFT 목록 API 구현
  - GET /api/nft/player/:address 엔드포인트
  - 데이터베이스에서 소유 NFT 조회
  - 메타데이터 포함하여 반환
  - _요구사항: 9.1_

- [ ] 7. 마켓플레이스 인증 API 구현
  - 웹 클라이언트를 위한 EIP-4361 기반 인증
  - _요구사항: 11.1, 11.2, 11.3, 11.4, 11.5, 11.6, 11.7_

- [ ] 7.1 인증 메시지 요청 API 구현
  - POST /api/marketplace/auth/request-message 엔드포인트
  - nonce 생성 및 데이터베이스 저장
  - EIP-4361 표준 메시지 생성 (타임스탬프 포함)
  - _요구사항: 11.1, 11.2_

- [ ] 7.2 서명 검증 API 구현
  - POST /api/marketplace/auth/verify 엔드포인트
  - 서명 검증 로직 (ecrecover 사용)
  - nonce 재사용 방지 (used 플래그 설정)
  - 세션 토큰 발급 (24시간 유효)
  - 로컬 스토리지 저장 안내
  - _요구사항: 11.3, 11.4, 11.5, 11.6, 11.7_

- [ ] 8. 마켓플레이스 서비스 로직 구현
  - P2P NFT 거래 및 서버 상점 비즈니스 로직
  - _요구사항: 12.1~12.12, 13.1~13.12_

- [ ] 8.1 MarketplaceService 클래스 작성
  - createListing() 함수 (판매 등록)
  - cancelListing() 함수 (판매 취소)
  - purchaseNFT() 함수 (NFT 구매)
  - getMarketListings() 함수 (판매 목록 조회)
  - _요구사항: 12.1, 12.2, 12.3, 12.4, 12.5, 12.6, 12.7, 12.8, 12.9, 12.10, 12.11, 12.12_

- [ ] 8.2 ShopService 클래스 작성
  - getShopItems() 함수 (상점 아이템 조회)
  - purchaseShopItem() 함수 (상점 아이템 구매)
  - generateItemMetadata() 함수 (소환권 메타데이터 생성)
  - _요구사항: 13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7, 13.8, 13.9, 13.10, 13.11, 13.12_

- [ ] 9. 마켓플레이스 API 엔드포인트 구현
  - 웹 클라이언트를 위한 마켓플레이스 API
  - _요구사항: 12.1~12.12, 13.1~13.12_

- [ ] 9.1 내 NFT 목록 조회 API
  - GET /api/marketplace/nfts/:address 엔드포인트
  - 소유 NFT 목록 및 판매 등록 여부 반환
  - _요구사항: 12.1_

- [ ] 9.2 판매 목록 조회 API
  - GET /api/marketplace/listings 엔드포인트
  - 필터링 및 정렬 기능 (가격순, 최신순)
  - 페이지네이션 지원
  - _요구사항: 12.5_

- [ ] 9.3 판매 등록 API
  - POST /api/marketplace/listings 엔드포인트
  - 소유권 검증 및 중복 등록 방지
  - 데이터베이스에 판매 정보 저장
  - _요구사항: 12.1, 12.2, 12.3, 12.4_

- [ ] 9.4 판매 취소 API
  - DELETE /api/marketplace/listings/:listingId 엔드포인트
  - 판매자 확인 및 상태 업데이트
  - _요구사항: 12.10_

- [ ] 9.5 NFT 구매 API
  - POST /api/marketplace/purchase 엔드포인트
  - 판매 정보 조회 및 검증
  - 토큰 잔액 확인
  - NFT 소유권 이전 및 토큰 결제
  - 판매 상태 업데이트 및 거래 내역 기록
  - _요구사항: 12.6, 12.7, 12.8, 12.9, 12.10, 12.11, 12.12_

- [ ] 9.6 서버 상점 아이템 목록 API
  - GET /api/marketplace/shop/items 엔드포인트
  - 재고가 있는 활성 아이템만 반환
  - _요구사항: 13.1, 13.2_

- [ ] 9.7 서버 상점 구매 API
  - POST /api/marketplace/shop/purchase 엔드포인트
  - 재고 확인 및 토큰 잔액 검증
  - 토큰 결제 → NFT 민팅 → 재고 감소 플로우
  - 구매 기록 저장
  - _요구사항: 13.3, 13.4, 13.5, 13.6, 13.7, 13.8, 13.9, 13.10, 13.11, 13.12_

- [ ] 9.8 거래 내역 조회 API
  - GET /api/marketplace/history/:address 엔드포인트
  - 구매/판매 내역 필터링
  - 페이지네이션 지원
  - _요구사항: 12.11_

- [ ] 10. 웹 마켓플레이스 프론트엔드 구축
  - 정적 HTML/CSS/JavaScript 웹사이트 개발
  - _요구사항: 11.1~11.7, 12.5, 12.11, 13.2_

- [ ] 10.1 프로젝트 구조 및 기본 파일 생성
  - marketplace/ 디렉토리 생성
  - index.html, my-nfts.html, market.html, shop.html, history.html 생성
  - css/, js/, assets/, lib/ 디렉토리 생성
  - _요구사항: 11.1_

- [ ] 10.2 공통 스타일 및 레이아웃 작성
  - main.css, components.css, responsive.css 작성
  - 네비게이션 바 및 푸터 레이아웃
  - NFT 카드 컴포넌트 스타일
  - _요구사항: 11.1_

- [ ] 10.3 MetaMask 연동 모듈 작성
  - metamask.js 파일 생성
  - MetaMaskConnector 클래스 구현
  - 지갑 연결, 서명 요청, 인증 플로우
  - _요구사항: 11.1, 11.2, 11.3, 11.4, 11.5_

- [ ] 10.4 API 클라이언트 모듈 작성
  - api.js 파일 생성
  - MarketplaceAPI 클래스 구현
  - 모든 API 엔드포인트 호출 함수
  - _요구사항: 11.4_

- [ ] 10.5 Web3 헬퍼 모듈 작성
  - web3-helper.js 파일 생성
  - Web3Helper 클래스 구현
  - 토큰 잔액 조회, NFT 메타데이터 조회 함수
  - _요구사항: 12.7, 13.4_

- [ ] 10.6 UI 렌더링 모듈 작성
  - ui.js 파일 생성
  - MarketplaceUI 클래스 구현
  - NFT 목록, 상세 정보, 폼 렌더링 함수
  - _요구사항: 12.5, 13.2_

- [ ] 10.7 홈페이지 구현
  - index.html 완성
  - 최신 등록 NFT 목록 표시
  - 지갑 연결 버튼 및 상태 표시
  - _요구사항: 11.1, 12.5_

- [ ] 10.8 내 NFT 페이지 구현
  - my-nfts.html 완성
  - 소유 NFT 목록 표시
  - 판매 등록 폼 및 취소 버튼
  - _요구사항: 12.1, 12.4_

- [ ] 10.9 마켓 페이지 구현
  - market.html 완성
  - 판매 중인 NFT 목록 표시
  - 가격순/최신순 정렬 및 필터링
  - 구매 버튼 및 확인 모달
  - _요구사항: 12.5, 12.6, 12.11_

- [ ] 10.10 서버 상점 페이지 구현
  - shop.html 완성
  - 상점 아이템 목록 표시
  - 재고 및 가격 정보
  - 구매 버튼 및 확인 모달
  - _요구사항: 13.2, 13.3, 13.11_

- [ ] 10.11 거래 내역 페이지 구현
  - history.html 완성
  - 구매/판매 내역 표시
  - 트랜잭션 해시 링크 (Etherscan)
  - 날짜별 필터링
  - _요구사항: 12.11_

- [ ] 11. 큐 관리 시스템 구현
  - Bull을 사용한 민팅/소각 요청 큐 관리
  - _요구사항: 10.1, 10.2, 10.3_

- [ ] 11.1 Redis 설치 및 설정
  - Redis 서버 설치
  - 연결 설정
  - _요구사항: 10.2_

- [ ] 11.2 QueueManager 클래스 작성
  - Bull 큐 초기화
  - addMintJob(), addBurnJob() 함수
  - 작업 처리 로직 (processMintJob, processBurnJob)
  - 재시도 및 백오프 설정
  - _요구사항: 10.1, 10.2, 10.3, 10.4_

- [ ] 12. 오류 처리 및 로깅 구현
  - 체계적인 오류 처리 및 로깅 시스템
  - _요구사항: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

- [ ] 12.1 오류 코드 정의
  - ErrorCode enum 작성
  - 인증, IPFS, 블록체인, NFT, 시스템 오류 코드
  - _요구사항: 6.4_

- [ ] 12.2 오류 핸들러 미들웨어 작성
  - Express 오류 핸들러
  - 오류 코드별 응답 생성
  - 사용자 친화적 메시지 (한국어)
  - _요구사항: 6.1, 6.5_

- [ ] 12.3 로깅 시스템 구현
  - Winston 또는 Pino 로거 설정
  - 로그 레벨별 분류 (info, warning, error, critical)
  - 파일 및 콘솔 출력
  - _요구사항: 6.4_

- [ ] 12.4 재시도 로직 구현
  - IPFS 업로드 재시도 (최대 3회)
  - 블록체인 트랜잭션 재시도 (최대 2회)
  - 데이터베이스 쿼리 재시도 (최대 3회)
  - _요구사항: 6.2, 6.3_

- [ ] 13. Unreal Engine 5 게임 클라이언트 구현
  - UE5에서 블록체인 기능을 사용할 수 있도록 클라이언트 구현
  - _요구사항: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.6, 3.1, 3.7_

- [ ] 13.1 UE5 프로젝트 기본 설정
  - UE5 프로젝트 생성 또는 기존 프로젝트 설정
  - HTTP 요청을 위한 플러그인 활성화 (HTTP, Json, JsonUtilities)
  - 프로젝트 구조 설정 (Blueprints 또는 C++)
  - _요구사항: 1.1_

- [ ] 13.2 MetaMask 인증 시스템 구현
  - MetaMaskAuthenticator 클래스 작성 (C++ 또는 Blueprint)
  - 브라우저 기반 MetaMask 연동 (외부 브라우저 또는 WebBrowser 위젯)
  - EIP-4361 서명 요청 생성 및 전송
  - 인증 토큰 저장 및 관리
  - _요구사항: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 13.3 브릿지 서버 API 클라이언트 구현
  - BridgeAPIClient 클래스 작성
  - HTTP 요청 헬퍼 함수 (GET, POST, DELETE)
  - 인증 토큰 헤더 자동 추가
  - 응답 파싱 및 오류 처리
  - _요구사항: 1.3, 2.1, 3.1_

- [ ] 13.4 게임 아이템 시스템 연동
  - NFTItemManager 클래스 작성
  - 게임 아이템과 NFT 매핑 데이터 구조
  - 민팅 가능한 아이템 식별 로직
  - 아이템 획득 시 민팅 트리거
  - 아이템 파괴 시 소각 트리거
  - _요구사항: 2.1, 3.1_

- [ ] 13.5 NFT 민팅 UI 구현
  - 민팅 요청 UI 위젯 (UMG)
  - 아이템 정보 표시 (이름, 설명, 속성)
  - 민팅 진행 상태 표시
  - 민팅 완료 알림
  - _요구사항: 2.6_

- [ ] 13.6 NFT 소각 UI 구현
  - 소각 확인 UI 위젯
  - 소각 진행 상태 표시
  - 소각 완료 확인
  - _요구사항: 3.7_

- [ ] 13.7 플레이어 NFT 목록 UI 구현
  - 소유한 NFT 목록 표시 UI
  - NFT 메타데이터 및 이미지 표시
  - 새로고침 기능
  - _요구사항: 2.6_

- [ ]* 13.8 게임 클라이언트 테스트
  - 민팅 플로우 테스트
  - 소각 플로우 테스트
  - 네트워크 오류 처리 테스트
  - _요구사항: 1.1, 2.1, 3.1_

- [ ] 14. 통합 테스트 및 배포
  - 전체 시스템 통합 테스트 및 배포 준비
  - _요구사항: 모든 요구사항_

- [ ] 14.1 환경 변수 설정
  - .env.example 파일 작성
  - 필수 환경 변수 문서화
  - _요구사항: 7.2_

- [ ] 14.2 엔드투엔드 테스트 시나리오 작성
  - 민팅 플로우 테스트
  - 소각 플로우 테스트
  - 마켓플레이스 로그인 테스트
  - P2P 거래 플로우 테스트
  - 서버 상점 구매 플로우 테스트
  - _요구사항: 모든 요구사항_

- [ ] 14.3 Rocky Linux VM에 브릿지 서버 배포
  - PM2로 프로세스 관리
  - Nginx 리버스 프록시 설정
  - 방화벽 규칙 설정
  - _요구사항: 10.1_

- [ ] 14.4 웹 마켓플레이스 정적 파일 배포
  - Nginx로 정적 파일 서빙
  - 또는 별도 웹 서버에 배포
  - _요구사항: 11.1_

- [ ] 14.5 모니터링 및 로그 확인
  - 서버 로그 확인
  - 트랜잭션 상태 모니터링
  - 오류 발생 시 알림 설정 (선택사항)
  - _요구사항: 10.6_
